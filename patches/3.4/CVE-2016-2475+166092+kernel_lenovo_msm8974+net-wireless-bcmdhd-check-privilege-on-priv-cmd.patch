From f471f27652f04fec436d894342eaa36edb4b316a Mon Sep 17 00:00:00 2001
From: Jerry Lee <jerrylee@broadcom.com>
Date: Fri, 15 Apr 2016 12:57:05 -0700
Subject: [PATCH] net: wireless: bcmdhd: check privilege on priv cmd

  check net admin capability for ioctl calls

BUG=26425765

Change-Id: Idae75c9fc530add3ead3508d25e994bbfec9a6de
---

diff --git a/drivers/net/wireless/bcmdhd/wl_android.c b/drivers/net/wireless/bcmdhd/wl_android.c
index 850694f..f33dcc4 100644
--- a/drivers/net/wireless/bcmdhd/wl_android.c
+++ b/drivers/net/wireless/bcmdhd/wl_android.c
@@ -447,6 +447,10 @@
 		ret = -EINVAL;
 		goto exit;
 	}
+	if (!capable(CAP_NET_ADMIN)) {
+		ret = -EPERM;
+		goto exit;
+	}
 	if (copy_from_user(&priv_cmd, ifr->ifr_data, sizeof(android_wifi_priv_cmd))) {
 		ret = -EFAULT;
 		goto exit;
