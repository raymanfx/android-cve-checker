From ff31a0b9677144f3d903c0355e67054c0a89d29a Mon Sep 17 00:00:00 2001
From: Dan Carpenter <dan.carpenter@oracle.com>
Date: Sun, 19 Jun 2016 21:28:43 +0200
Subject: [PATCH] KEYS: potential uninitialized variable

If __key_link_begin() failed then "edit" would be uninitialized. I've
added a check to fix that.

Change-Id: I0e28bdba07f645437db2b08daf67ca27f16c6f5c
Fixes: f70e2e06196a ('KEYS: Do preallocation for __key_link()')
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
---

diff --git a/security/keys/key.c b/security/keys/key.c
index 06783cf..5f9902e 100644
--- a/security/keys/key.c
+++ b/security/keys/key.c
@@ -573,7 +573,7 @@
 
 	mutex_unlock(&key_construction_mutex);
 
-	if (keyring)
+	if (keyring && link_ret == 0)
 		__key_link_end(keyring, key->type, prealloc);
 
 	/* wake up anyone waiting for a key to be constructed */
