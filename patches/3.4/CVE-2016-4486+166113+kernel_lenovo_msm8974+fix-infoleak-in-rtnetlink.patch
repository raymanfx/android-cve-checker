From cf4201989535f64273083d2acb7dafb5fb789c65 Mon Sep 17 00:00:00 2001
From: kangjie <kangjielu@gmail.com>
Date: Tue, 03 May 2016 21:49:23 -0400
Subject: [PATCH] fix infoleak in rtnetlink

the stack object "map" has a total size of 32 bytes. Its last 4
bytes are padding generated by compiler. These padding bytes are
not initialized and sent out via "nla_put"

Bug: 28620102

Change-Id: I13da380c6fe8abca49e3cf9f05293c02b44d2e5e
Signed-off-by: kangjie <kangjielu@gmail.com>
(cherry picked from commit d7bd06d4e7f6b8f9019bb993fd41dc361154abc3)
---

diff --git a/net/core/rtnetlink.c b/net/core/rtnetlink.c
index 1604bf2..f58f294 100644
--- a/net/core/rtnetlink.c
+++ b/net/core/rtnetlink.c
@@ -914,14 +914,14 @@
 		NLA_PUT_STRING(skb, IFLA_IFALIAS, dev->ifalias);
 
 	if (1) {
-		struct rtnl_link_ifmap map = {
-			.mem_start   = dev->mem_start,
-			.mem_end     = dev->mem_end,
-			.base_addr   = dev->base_addr,
-			.irq         = dev->irq,
-			.dma         = dev->dma,
-			.port        = dev->if_port,
-		};
+		struct rtnl_link_ifmap map;
+		memset(&map, 0, sizeof(map));
+		map.mem_start   = dev->mem_start;
+		map.mem_end     = dev->mem_end;
+		map.base_addr   = dev->base_addr;
+		map.irq         = dev->irq;
+		map.dma         = dev->dma;
+		map.port        = dev->if_port;
 		NLA_PUT(skb, IFLA_MAP, sizeof(map), &map);
 	}
 
